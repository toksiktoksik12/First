<!DOCTYPE html>
<html dir="rtl">
<head>
  <meta charset="UTF-8">
  <style>
    body { width: 400px; padding: 15px; font-family: Arial; }
    h2 { color: #e74c3c; text-align: center; }
    button { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 5px; background: #e74c3c; color: white; font-size: 16px; cursor: pointer; }
    button:hover { background: #c0392b; }
    #result { margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; max-height: 500px; overflow-y: auto; font-size: 12px; }
    .debug-info { background: #fff3cd; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 4px solid #ffc107; }
    .listing { background: white; margin: 5px 0; padding: 10px; border-radius: 5px; border-left: 3px solid #28a745; }
  </style>
</head>
<body>
  <h2>ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</h2>
  <p style="text-align: center; color: #666;">Ø³ÙŠØ·Ø¨Ø¹ ÙƒÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙŠ Console</p>
  
  <button id="extractBtn">ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„ØµÙØ­Ø©</button>
  
  <div id="result">
    <p><strong>ØªØ¹Ù„ÙŠÙ…Ø§Øª:</strong></p>
    <p>1. Ø§Ø¶ØºØ· F12 Ù„ÙØªØ­ Developer Tools</p>
    <p>2. Ø§Ø°Ù‡Ø¨ Ù„ØªØ¨ÙˆÙŠØ¨ Console</p>
    <p>3. Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø£Ø¹Ù„Ø§Ù‡</p>
    <p>4. Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Console</p>
  </div>
  
  <script>
    document.getElementById('extractBtn').onclick = async function() {
      const btn = this;
      const result = document.getElementById('result');
      
      btn.disabled = true;
      btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´Ø®ÙŠØµ...';
      
      try {
        const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
        const response = await chrome.tabs.sendMessage(tab.id, { action: 'extractListings' });
        
        if (response && response.success) {
          result.innerHTML = `
            <div class="debug-info">
              <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØµÙØ­Ø©:</h3>
              <p>ğŸ”— Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·: ${response.debug.totalLinks}</p>
              <p>ğŸª Ø±ÙˆØ§Ø¨Ø· Marketplace: ${response.debug.marketplaceLinks}</p>
              <p>ğŸ–¼ï¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙˆØ±: ${response.debug.totalImages}</p>
              <p>ğŸ’° Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø¹Ø§Ø±: ${response.debug.priceElements}</p>
              <p>ğŸ“Š Ø¹Ù†Ø§ØµØ± Data: ${response.debug.dataElements}</p>
            </div>
            
            <h3>ğŸ“‹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© (${response.count}):</h3>
          `;
          
          if (response.count > 0) {
            response.listings.forEach(listing => {
              result.innerHTML += `
                <div class="listing">
                  <strong>${listing.text}</strong><br>
                  ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${listing.price}<br>
                  <small>ğŸ”— ${listing.url.substring(0, 50)}...</small>
                </div>
              `;
            });
          } else {
            result.innerHTML += '<p style="color: red;">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</p>';
          }
          
          result.innerHTML += `
            <div class="debug-info">
              <p><strong>ğŸ” Ø±Ø§Ø¬Ø¹ Console Ù„Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©!</strong></p>
              <p>Ø§Ø¶ØºØ· F12 â†’ Console Ù„Ø±Ø¤ÙŠØ© ÙƒÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„</p>
            </div>
          `;
        } else {
          result.innerHTML = '<p style="color: red;">ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ´Ø®ÙŠØµ</p>';
        }
      } catch (error) {
        result.innerHTML = `<p style="color: red;">Ø®Ø·Ø£: ${error.message}</p>`;
      }
      
      btn.disabled = false;
      btn.textContent = 'ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„ØµÙØ­Ø©';
    };
  </script>
</body>
</html>